---
import BaseLayout from "../layouts/BaseLayout.astro";
import ProjectsShowcase from "../components/ProjectsShowcase.astro";
import AboutSection from "../components/AboutSection.astro";
import TechMarquee from "../components/TechMarquee.astro";
---

<BaseLayout
  title="Wint Khant Lin aka Happer"
  description="Hello, I am Wint Khant Lin, also known as Happer. I am a college student from Myanmar. I love coding, listening to music."
>
  <main
    id="home"
    class="body-mono relative flex min-h-screen flex-col justify-center px-4 py-20 text-center"
  >
    <h1
      id="heading-text"
      class="heading-sans mx-auto max-w-8xl text-7xl font-black leading-[1.15] text-center text-balance"
    >
      <span id="anim-text">Yooo ðŸ‘‹, I am</span>

      <span
        id="name-span"
        class="highlight-blue ink-text mx-2 inline-block overflow-hidden whitespace-nowrap rounded-md"
      >
        Wint Khant Lin.
      </span>

      <span id="anim-text-2" class="mt-2 block"
        >I am currently learning software engineering.</span
      >
    </h1>
  </main>

  <div class="w-full mt-12 sm:my-16">
    <TechMarquee />
  </div>

  <ProjectsShowcase />
  <AboutSection />
</BaseLayout>

<script>
  import { gsap } from "gsap";
  import SplitText from "gsap/SplitText";

  gsap.registerPlugin(SplitText);

  let hasInitialized = false;
  let splitInstances: SplitText[] = [];

  function cleanupHeroAnimation() {
    gsap.killTweensOf("#name-span");
    gsap.killTweensOf("#anim-text span");
    gsap.killTweensOf("#anim-text-2 span");
    splitInstances.forEach((split) => split.revert());
    splitInstances = [];
    hasInitialized = false;
  }

  function initHeroAnimation() {
    if (hasInitialized) return;

    const intro = document.querySelector("#anim-text");
    const outro = document.querySelector("#anim-text-2");
    const nameSpan = document.querySelector("#name-span");
    if (!intro || !outro || !nameSpan) return;

    if (window.matchMedia("(prefers-reduced-motion: reduce)").matches) return;
    hasInitialized = true;

    const introSplit = new SplitText(intro, { type: "words" });
    const nameSplit = new SplitText(nameSpan, { type: "chars" });
    const outroSplit = new SplitText(outro, { type: "words" });
    splitInstances = [introSplit, nameSplit, outroSplit];

    const allChars = [
      ...introSplit.words,
      ...nameSplit.chars,
      ...outroSplit.words,
    ];

    gsap.set(allChars, { y: 70, opacity: 0, display: "inline-block" });
    gsap.set(nameSpan, {
      scaleX: 0.0,
      opacity: 0.65,
      transformOrigin: "left center",
    });

    gsap.timeline({ defaults: { ease: "expo.out" } })
      .to(nameSpan, {
        scaleX: 1,
        opacity: 1,
        duration: 0.45,
      })
      .to(
        allChars,
        {
          y: 0,
          opacity: 1,
          duration: 0.35,
          stagger: 0.014,
          ease: "back.out(1.7)",
        },
        "-=0.15"
      );
  }

  document.addEventListener("astro:before-swap", cleanupHeroAnimation);
  document.addEventListener("astro:page-load", initHeroAnimation);

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initHeroAnimation, {
      once: true,
    });
  } else {
    initHeroAnimation();
  }
</script>
